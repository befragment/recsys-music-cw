# Scripts

Вспомогательные скрипты для работы с проектом.

## populate_tracks.py

Скрипт для парсинга MP3 файлов из `data/fma_small` и заполнения таблицы `tracks` в базе данных.

### Автоматический запуск с Docker

При запуске через `docker-compose up -d` скрипт автоматически выполняется во время старта контейнера бота. Он:
1. Ждет готовности PostgreSQL
2. Создает необходимые таблицы
3. Заполняет таблицу `tracks` из MP3 файлов (если она пуста)
4. Запускает бота

### Ручное использование

#### Локальный запуск (без Docker)

1. Установите зависимости (если еще не установлены):
```bash
cd bot
pip install -r requirements.txt
```

2. Убедитесь, что у вас настроены переменные окружения (файл `.env` в корне проекта):
```
BOT_TOKEN=your_bot_token
POSTGRES_URL=postgresql+asyncpg://user:password@localhost:5432/dbname
```

3. Запустите скрипт:
```bash
python scripts/populate_tracks.py
```

#### Опции командной строки

```bash
# Пропустить если данные уже есть (для автоматизации)
python scripts/populate_tracks.py --skip-if-exists

# Указать другую директорию с данными
python scripts/populate_tracks.py --data-dir /path/to/mp3/files

# Комбинация опций
python scripts/populate_tracks.py --skip-if-exists --data-dir /custom/path
```

### Что делает скрипт

1. Сканирует директорию `data/fma_small` рекурсивно и находит все MP3 файлы
2. Извлекает метаданные из каждого файла:
   - Название трека (title)
   - Исполнитель (artist)
   - Альбом (album) - опционально
   - Длительность в миллисекундах (duration_ms)
   - Локальный путь к файлу (local_path)
3. Сохраняет данные в таблицу `tracks` батчами по 100 записей
4. Показывает прогресс и статистику

### Примечания

- Если в MP3 файле нет тегов, используется имя файла в качестве названия трека
- Если исполнитель не указан, используется "Unknown Artist"
- В интерактивном режиме: если таблица уже содержит данные, скрипт спросит, нужно ли их очистить
- С флагом `--skip-if-exists`: пропускает заполнение если данные уже есть
- Скрипт автоматически создает таблицы, если их нет

## docker-entrypoint.sh

Entrypoint скрипт для Docker контейнера. Выполняет последовательность действий:
1. Ожидает готовности PostgreSQL (проверка через `pg_isready`)
2. Создает таблицы в БД если их нет
3. Запускает `populate_tracks.py` с флагом `--skip-if-exists`
4. Стартует основное приложение бота

